<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="saruter">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Solvis Heizung via Modbus auslesen und steuern - Smarthome Doku</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Solvis Heizung via Modbus auslesen und steuern";
    var mkdocs_page_input_path = "projekte/Solvis Heizung.md";
    var mkdocs_page_url = "/projekte/Solvis Heizung/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Smarthome Doku</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Projekte</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Solvis Heizung via Modbus auslesen und steuern</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#solvis-heizung-via-modbus-auslesen-und-steuern">Solvis Heizung via Modbus auslesen und steuern</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#benotigte-hardware">benötigte Hardware</a></li>
        
            <li><a class="toctree-l4" href="#home-assistant-ubersicht">Home Assistant Übersicht</a></li>
        
            <li><a class="toctree-l4" href="#langzeitauswertung-mit-grafanainfluxdb">Langzeitauswertung mit Grafana/InfluxDB</a></li>
        
            <li><a class="toctree-l4" href="#aktivierung-modbus-protokoll">Aktivierung Modbus Protokoll</a></li>
        
            <li><a class="toctree-l4" href="#auszug-configurationyaml">Auszug configuration.yaml</a></li>
        
            <li><a class="toctree-l4" href="#raumtemperatur-per-modbus-register-statt-raumbedienelement">Raumtemperatur per Modbus-Register statt Raumbedienelement</a></li>
        
            <li><a class="toctree-l4" href="#stundenweises-umschalten-von-automatik-auf-standby-betrieb">Stundenweises umschalten von Automatik auf Standby-Betrieb</a></li>
        
            <li><a class="toctree-l4" href="#links-zu-solvis-doku">Links zu Solvis Doku</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../feinstaubsensor/">Feinstaubsensor mit ESP8266 und Home Assistant</a>
                </li>
                <li class="">
                    
    <a class="" href="../gasverbrauch/">Gaszähler mit ESP8266 und Home Assistant auslesen</a>
                </li>
                <li class="">
                    
    <a class="" href="../stromverbrauch/">(digitalen) Stromzähler mit ESP8266 auslesen</a>
                </li>
                <li class="">
                    
    <a class="" href="../tasterschaltung/">Eltako Stromstoßrelais durch Shelly 1PM ersetzen</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Smarthome Doku</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Projekte &raquo;</li>
        
      
    
    <li>Solvis Heizung via Modbus auslesen und steuern</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="solvis-heizung-via-modbus-auslesen-und-steuern">Solvis Heizung via Modbus auslesen und steuern<a class="headerlink" href="#solvis-heizung-via-modbus-auslesen-und-steuern" title="Permanent link">&para;</a></h1>
<p>Eine <a href="https://www.solvis.de">Solvis Heizungsanlage</a>, hier SolvisMax, lässt sich mit Hilfe der optional erhältlichen <a href="https://www.solvis.de/solvisremote-ben-max/">Solvis Remote</a> fernsteuern. Die Solvis Remote bildet im Prinzip das Touchdisplay der Heizung 1:1 via Browser nach. Zusätzlich gibt es Graphen über den Temperaturverlauf der einzelnen Sensoren des Schichtenspeichers und die Möglichkeit, sich ein Anlagenschema darzustellen. </p>
<p>Für eine Integration ein ein bestehendes Smart Home System, hier <a href="https://www.home-assistant.io">Home Assistant</a>, bietet die Solvis Remote zusätzlich die Möglichkeit die Heizung mittels Modbus-TCP Protokoll lokal auslesen und, falls gewünscht, auch steuern zu können. </p>
<p>Vorbildlich ist die Bereitstellung aller Dokumentationen inkl. Modbus Register von Solvis auf deren Webseite. </p>
<h2 id="benotigte-hardware">benötigte Hardware<a class="headerlink" href="#benotigte-hardware" title="Permanent link">&para;</a></h2>
<ul>
<li>Solvis Heizung, hier SolvisMax 7</li>
<li>Solvis Control 2 (SC2)</li>
<li>Solvis Remote zur Anbindung ans Netzwerk und Bereitstellung des Modbus-TCP Protokolls</li>
</ul>
<h2 id="home-assistant-ubersicht">Home Assistant Übersicht<a class="headerlink" href="#home-assistant-ubersicht" title="Permanent link">&para;</a></h2>
<p>In Home Assistant wurde die Ansicht der Anlage auf der Solvis Remote nachgebildet
<img alt="Heizung Übersicht" src="../../img/hass-heizung-uebersicht.png" /></p>
<p>Zusätzlich gibt es eine Detail-Ansicht der einzelnen Sensoren und Stati.
<img alt="Heizung Sensoren" src="../../img/hass-heizung-detail.png" /></p>
<p>Klick auf die einzelnen Sensoren bringen die Historie des Sensors bzw. die Auswahlmöglichkeiten zur Steuerung, z.b. den HKR1-Betriebsmodus zu ändern</p>
<p><img alt="Heizung Detail1" src="../../img/hass-heizung-wwpuffer-history.png" /> 
<img alt="Heizung Detail2" src="../../img/hass-heizung-hkr1-betriebsart.png" /></p>
<h2 id="langzeitauswertung-mit-grafanainfluxdb">Langzeitauswertung mit Grafana/InfluxDB<a class="headerlink" href="#langzeitauswertung-mit-grafanainfluxdb" title="Permanent link">&para;</a></h2>
<p>Für Langzeitstatistiken werden die Daten von Home Assistant in einer InfluxDB Datenbank gespeichert und mittels Grafana visualisiert.
<img alt="Heizung Grafana" src="../../img/heizung-grafana.png" /></p>
<p>Für die monatliche Auswertung der Brennerstarts und Laufzeit des Brenners werden mit folgenden Queries die Daten ermittelt:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">spread</span><span class="p">(</span><span class="ss">&quot;value&quot;</span><span class="p">)</span> <span class="k">FROM</span> <span class="ss">&quot;Starts&quot;</span> <span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;entity_id&quot;</span> <span class="o">=</span> <span class="s1">&#39;brennerstarts&#39;</span><span class="p">)</span> <span class="k">AND</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">()</span>  <span class="o">-</span> <span class="mi">365</span><span class="n">d</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">time</span><span class="p">(</span><span class="mi">30</span><span class="n">d</span><span class="p">)</span> <span class="n">fill</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>

<span class="k">SELECT</span> <span class="n">spread</span><span class="p">(</span><span class="ss">&quot;value&quot;</span><span class="p">)</span> <span class="k">FROM</span> <span class="ss">&quot;h&quot;</span> <span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;entity_id&quot;</span> <span class="o">=</span> <span class="s1">&#39;laufzeit_brenner&#39;</span><span class="p">)</span> <span class="k">AND</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">365</span><span class="n">d</span>  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">time</span><span class="p">(</span><span class="mi">30</span><span class="n">d</span><span class="p">)</span> <span class="n">fill</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="aktivierung-modbus-protokoll">Aktivierung Modbus Protokoll<a class="headerlink" href="#aktivierung-modbus-protokoll" title="Permanent link">&para;</a></h2>
<p>Zur Aktivierung von Modbus TCP muss in das Installateurmenü gewechselt werden. Den zugehörigen Code werde ich nicht veröffentlichen. Bitte mit dem Installateur der Heizung Kontakt aufnehmen. 
Im Menüpunkt <code>Sonstiges --&gt; Remote</code> auswählen und dort dann den Modus für <code>Modbus TCP</code> auf <code>lesen</code> oder auch <code>senden</code> (schreiben) einstellen.
Sollten die Einstellungen korrekt sein sollte unter der IP-Addresse der Solvis-Remote auf Port TCP/502 ein Connect möglich sein.</p>
<p><img alt="Solvis Remote1" src="../../img/solvis-remote-1.png" /></p>
<p><img alt="Solvis Remote2" src="../../img/solvis-remote-2.png" /></p>
<h2 id="auszug-configurationyaml">Auszug configuration.yaml<a class="headerlink" href="#auszug-configurationyaml" title="Permanent link">&para;</a></h2>
<p>Nachfolgend ein Auszug der configuration.yaml von Home Assistant mit den wichtigsten Sensoren und Templates</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nv">modbus</span>:
  <span class="nv">name</span>: <span class="nv">SolvisRemote</span>
  <span class="nv">type</span>: <span class="nv">tcp</span>
  <span class="nv">host</span>: <span class="o">&lt;</span><span class="nv">ip</span><span class="o">-</span><span class="nv">addresse</span><span class="o">-</span><span class="nv">solvis</span><span class="o">-</span><span class="nv">remote</span><span class="o">&gt;</span>
  <span class="nv">port</span>: <span class="mi">502</span>

 <span class="o">-</span> <span class="nv">platform</span>: <span class="nv">modbus</span>
    <span class="nv">scan_interval</span>: <span class="mi">30</span>
    <span class="nv">registers</span>:
    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Warmwasserpuffer</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33024</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Warmwassertemperatur</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33025</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Speicherreferenztemperatur</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33026</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Heizungspuffertemperatur</span> <span class="nv">oben</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33027</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Aussentemperatur</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33033</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Heizungspuffertemperatur</span> <span class="nv">unten</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33032</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Zirkulationsdurchfluss</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33034</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Vorlauftemperatur</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33035</span>

#    <span class="nv">kein</span> <span class="nv">Sensor</span> <span class="nv">angeschlossen</span>, <span class="nv">zeigt</span> <span class="nv">immer</span> <span class="mi">10</span>°<span class="nv">C</span>  
#    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Kaltwassertemperatur</span>
#      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
#      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
#      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
#      <span class="nv">slave</span>: <span class="mi">1</span>
#      <span class="nv">precision</span>: <span class="mi">2</span>
#      <span class="nv">register_type</span>: <span class="nv">input</span>
#      <span class="nv">register</span>: <span class="mi">33038</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Durchfluss</span> <span class="nv">Warmwasserzirkualation</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">l</span><span class="o">/</span><span class="nv">min</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33041</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Laufzeit</span> <span class="nv">Brenner</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">h</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">0</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33536</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Brennerstarts</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">Starts</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">0</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33537</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Brennerleistung</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">kW</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33539</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">Ionisationsstrom</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">mA</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">1</span>
      <span class="nv">precision</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33540</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">VersionSC2</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">01</span>
      <span class="nv">precision</span>: <span class="mi">2</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">32770</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">VersionNBG</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">01</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">32771</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">ZirkulationBetriebsart</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">2049</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">A01</span>.<span class="nv">Pumpe</span> <span class="nv">Zirkulation</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">V</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">01</span>
      <span class="nv">precision</span>: <span class="mi">0</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33280</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">A02</span>.<span class="nv">Pumpe</span> <span class="nv">Warmwasser</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">V</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">01</span>
      <span class="nv">precision</span>: <span class="mi">0</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33281</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">A03</span>.<span class="nv">Pumpe</span> <span class="nv">HK1</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">V</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">01</span>
      <span class="nv">precision</span>: <span class="mi">0</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33282</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">A12</span>.<span class="nv">Brennerstatus</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">unit_of_measurement</span>: <span class="nv">V</span>
      <span class="nv">scale</span>: <span class="mi">0</span>.<span class="mi">01</span>
      <span class="nv">precision</span>: <span class="mi">0</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33291</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">DigIn</span> <span class="nv">Stoerungen</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">input</span>
      <span class="nv">register</span>: <span class="mi">33045</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">HKR1</span> <span class="nv">Betriebsart</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">holding</span>
      <span class="nv">register</span>: <span class="mi">2818</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">WW</span> <span class="nv">Solltemperatur</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">holding</span>
      <span class="nv">register</span>: <span class="mi">2305</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">HKR1</span> <span class="nv">Solltemperatur</span> <span class="nv">Tag</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">holding</span>
      <span class="nv">register</span>: <span class="mi">2820</span>

    <span class="o">-</span> <span class="nv">name</span>: <span class="nv">HKR1</span> <span class="nv">Absenktemperatur</span> <span class="nv">Nacht</span>
      <span class="nv">hub</span>: <span class="nv">SolvisRemote</span> 
      <span class="nv">unit_of_measurement</span>: °<span class="nv">C</span>
      <span class="nv">slave</span>: <span class="mi">1</span>
      <span class="nv">register_type</span>: <span class="nv">holding</span>
      <span class="nv">register</span>: <span class="mi">2821</span>



  <span class="o">-</span> <span class="nv">platform</span>: <span class="nv">template</span>
    <span class="nv">sensors</span>:
      <span class="nv">ww_zirkulationsart</span>:
       <span class="nv">friendly_name</span>: <span class="s2">&quot;</span><span class="s">WW Zirkulation Betriebsart</span><span class="s2">&quot;</span>
       <span class="nv">entity_id</span>: <span class="nv">sensor</span>.<span class="nv">zirkulationbetriebsart</span>
       <span class="nv">value_template</span>: <span class="o">&gt;-</span>
          {<span class="o">%</span> <span class="k">if</span> <span class="nv">states</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">sensor.zirkulationbetriebsart</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">1</span><span class="s1">&#39;</span> <span class="o">%</span>}
            <span class="nv">Aus</span>
          {<span class="o">%</span> <span class="nv">elif</span> <span class="nv">states</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">sensor.zirkulationbetriebsart</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">2</span><span class="s1">&#39;</span> <span class="o">%</span>}
            <span class="nv">Puls</span>
          {<span class="o">%</span> <span class="nv">elif</span> <span class="nv">states</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">sensor.zirkulationbetriebsart</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">3</span><span class="s1">&#39;</span> <span class="o">%</span>}
            <span class="nv">Temp</span>
          {<span class="o">%</span> <span class="nv">elif</span> <span class="nv">states</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">sensor.zirkulationbetriebsart</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">4</span><span class="s1">&#39;</span> <span class="o">%</span>}
            <span class="nv">Warten</span>
          {<span class="o">%</span> <span class="k">else</span> <span class="o">%</span>}
            <span class="nv">unbekannt</span>
          {<span class="o">%</span> <span class="k">endif</span> <span class="o">%</span>}


      <span class="nv">hkr1betriebsart</span>:
        <span class="nv">friendly_name</span>: <span class="s2">&quot;</span><span class="s">Heizkreislauf Betriebsart</span><span class="s2">&quot;</span>
        <span class="nv">entity_id</span>: <span class="nv">sensor</span>.<span class="nv">hkr1_betriebsart</span>
        <span class="nv">value_template</span>: <span class="s2">&quot;</span><span class="s">{%if states.sensor.hkr1_betriebsart.state == &#39;1&#39; %}Aus{% elif states.sensor.hkr1_betriebsart.state == &#39;2&#39; %}Automatik{% elif states.sensor.hkr1_betriebsart.state == &#39;3&#39; %}Tagbetrieb{% elif states.sensor.hkr1_betriebsart.state == &#39;4&#39; %}Absenkbetrieb{% elif states.sensor.hkr1_betriebsart.state == &#39;5&#39; %}Standby{% elif states.sensor.hkr1_betriebsart.state == &#39;6&#39; %}Eco{% elif states.sensor.hkr1_betriebsart.state == &#39;7&#39; %}Urlaub{% elif states.sensor.hkr1_betriebsart.state == &#39;8&#39; %}WW Vorang{% elif states.sensor.zirkulationbetriebsart.state == &#39;9&#39; %}Frostschutz{% elif states.sensor.zirkulationbetriebsart.state == &#39;10&#39; %}Pumpenschutz{% elif states.sensor.hkr1_betriebsart.state == &#39;11&#39; %}Estrich{% endif %}</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table>

<h2 id="raumtemperatur-per-modbus-register-statt-raumbedienelement">Raumtemperatur per Modbus-Register statt Raumbedienelement<a class="headerlink" href="#raumtemperatur-per-modbus-register-statt-raumbedienelement" title="Permanent link">&para;</a></h2>
<p>Normalerweise wird über das (optionale) Raumbedienelement die Raumtemperatur an die Solvis Control2 (SC2) gemeldet. Dadurch kann die Heizung die Regelung an die erreichte Raumtemperatur anpassen.</p>
<p>Da im Haus keine einfache Verkabelung des Raumbedienelements möglich war, es aber ein Modbus Register 34304 (Raumtemperatur 1) gibt, war die Idee geboren die Raumtemperatur über die in Home Assistant vorhandenen Zigbee Temperatursensoren per Modbus in das Register zu schreiben, was zunächst fehlschlug, trotz aktiviertem schreibenden Modbus-Zugriff. Allerdings war zu dem Zeitpunkt die SC2 noch nicht für ein Raumbedienelement eingerichtet.</p>
<p>Nach Kontaktaufnahme mit Solvis bekam ich die Infos dir mir fehlten. Vielen Dank hierfür an <a href="https://github.com/saruter/smarthome/issues/1">Wolf Walter</a></p>
<h3 id="voraussetzungen">Voraussetzungen<a class="headerlink" href="#voraussetzungen" title="Permanent link">&para;</a></h3>
<ul>
<li>Solvis Control muss mit Raumbedienelement für den Heizkreislauf konfiguriert sein (auch wenn kein Raumbedienelement per Kabel angeschlossen wird)</li>
<li>dafür ist ein Zurücksetzen der Solvis Control auf Werkseinstellung nötig, da in der Initialisierung das Raumbedienelement zum Heizkreislauf zugeordnet wird</li>
<li>Anschließend muss im Installateur-Menü unter <code>Sonstiges --&gt; Remote --&gt; Seite 3 --&gt; Raumfühler HK1</code> auf <code>Modbus</code> umgestellt werden
<img alt="Remote-HKR1-Raumfühler-Modbus" src="../../img/solvis-remote-raumtemp-modbus.png" /></li>
<li>und der Modbus-Modus muss auf <code>senden</code> was dem schreibenden Zugriff entspricht umgestellt werden, falls noch nicht geschehen</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Hinweis</p>
<p>Die Temperatur muss ca. alle 60 Sekunden per Modbus in das Register geschrieben werden, sonst "verschwindet" die Temperatur in der Anzeige und zeigt nur noch "--"</p>
</div>
<h3 id="zyklisches-setzen-der-raumtemperatur-in-home-assistant">zyklisches setzen der Raumtemperatur in Home Assistant<a class="headerlink" href="#zyklisches-setzen-der-raumtemperatur-in-home-assistant" title="Permanent link">&para;</a></h3>
<p>Eine Automatisierung schreibt den Sensorwert eines Zigbee Temperatursensors alle 30 Sekunden in das Modbus Register.</p>
<p>Dazu muss der Wert des Sensors konvertiert werden, da das Modbus-Register den Wert in 0.1°C skaliert erwartet. Zudem muss der Wert in ein <code>int</code> gewandelt werden da der <code>modbus.write_register</code>-Service ein <code>int</code> erwartet.</p>
<h4 id="automatisierung">Automatisierung<a class="headerlink" href="#automatisierung" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">  - alias: Heizung Raumtemperatur per Modbus aktualisieren</span>
<span class="x">    trigger:</span>
<span class="x">      platform: time_pattern</span>
<span class="x">      seconds: &quot;/30&quot;</span>
<span class="x">    action:</span>
<span class="x">    - service: modbus.write_register</span>
<span class="x">      data_template:</span>
<span class="x">        address: 34304</span>
<span class="x">        hub: SolvisRemote</span>
<span class="x">        unit: 1</span>
<span class="x">        value: &quot;</span><span class="cp">{{</span> <span class="o">(</span><span class="nv">states</span><span class="o">(</span><span class="s1">&#39;sensor.temperatur_wohnzimmer&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">float</span> <span class="o">*</span> <span class="m">10</span><span class="o">)</span> <span class="o">|</span> <span class="nf">int</span> <span class="cp">}}</span><span class="x">&quot;</span>
</pre></div>
</td></tr></table>

<h3 id="raumtemperaturanzeige-in-der-sc2">Raumtemperaturanzeige in der SC2<a class="headerlink" href="#raumtemperaturanzeige-in-der-sc2" title="Permanent link">&para;</a></h3>
<p>Bei erfolgreichem setzen der Temperatur erscheint diese in der Solvis Control
<img alt="Remote-Raumtemp1" src="../../img/solvis-raumtemp-startseite.png" /></p>
<p><img alt="Remote-Raumtemp2" src="../../img/solvis-raumtemp-anlagenstatus.png" /></p>
<h2 id="stundenweises-umschalten-von-automatik-auf-standby-betrieb">Stundenweises umschalten von Automatik auf Standby-Betrieb<a class="headerlink" href="#stundenweises-umschalten-von-automatik-auf-standby-betrieb" title="Permanent link">&para;</a></h2>
<p>Gerade in der Übergangszeit kann es vorkommen, dass an sonnigen Tagen trotz noch kühler Außentemperatur es in den Zimmern durch die Sonneneinstrahlung bereits warm ist. Die Heizung aber noch wegen der kühlen Außentemperatur weiterhin läuft bis auch die Außentemperatur entsprechend später am Tag steigt.</p>
<p>Hier wäre ein Nutzungsszenario für folgende Automatisierung:
Schalte den Heizkreis auf Standby-Modus für x-Stunden (z.B. bis Abends).</p>
<p><img alt="stundenweises Standby HKR1" src="../../img/hass-heizung-automate-standby.png" /></p>
<p>Realisiert ist dies über einen <code>timer</code> in Home-Assistant, dessen Zeitwert (Stunden) per <code>input_number</code> gesetzt wird (Schieberegler im Frontend). Über ein <code>input_boolean</code> (Ein-/Ausschalter im Frontend) wird dann eine Automatisierung ausgeführt, die den Timer startet (<code>service: timer.start</code>) und das Modbus Register 2818 auf den Wert <code>5</code> (HKR1 Standbymodus) schreibt.</p>
<p>Wenn der Timer abgelaufen ist, startet eine zweite Automatisierung (getriggert durch <code>event_type: timer.finished</code>) die dann den Ein-/Ausschalter wieder auf "Aus" setzt.</p>
<p>Durch das setzen des Ein-Ausschalters auf "Aus" durch diese Automatisierung wird wiederum eine weitere Automatisierung getriggert die dann zum Einen das Modbus-Register 2818 wieder auf <code>2</code> (Automatik) setzt, also den Heizkreis wieder in den normalen Automatikmodus versetzt. Der zweite Anwendungsfall ist das manuelle Umschalten des Ein-/Ausschalters in der Weboberfläche auf "Aus" um wieder manuell auf "Automatik" umzuschalten. Auch hier triggert diese Automatisierung. </p>
<h3 id="konfiguration-home-assistant">Konfiguration Home-Assistant<a class="headerlink" href="#konfiguration-home-assistant" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># <span class="nv">Eingabefelder</span> 
<span class="nv">input_number</span>:
  <span class="nv">delayheizungstandby</span>:
    <span class="nv">name</span>: <span class="nv">Stunden</span> <span class="nv">auf</span> <span class="nv">Standby</span>
    <span class="nv">initial</span>: <span class="mi">5</span>
    <span class="nv">min</span>: <span class="mi">1</span>
    <span class="nv">max</span>: <span class="mi">8</span>
    <span class="nv">step</span>: <span class="mi">1</span>
    <span class="nv">icon</span>: <span class="nv">mdi</span>:<span class="nv">timer</span>

<span class="nv">input_boolean</span>:
  <span class="nv">heizungstandbyon</span>:
    <span class="nv">name</span>: <span class="nv">Heizung</span> <span class="nv">stundenweise</span> <span class="nv">auf</span> <span class="nv">Standby</span>
    <span class="nv">initial</span>: <span class="nv">off</span>


# <span class="nv">Timer</span> <span class="k">for</span> <span class="nv">setting</span> <span class="nv">heating</span> <span class="nv">on</span> <span class="nv">standby</span> <span class="k">for</span> <span class="nv">x</span> <span class="nv">hours</span>
<span class="nv">timer</span>:
  <span class="nv">heizungaufstandbyfor</span>:
    <span class="nv">name</span>: <span class="nv">Noch</span> <span class="nv">auf</span> <span class="nv">Standby</span> <span class="nv">f</span>ü<span class="nv">r</span>


<span class="nv">automation</span>:

  <span class="o">-</span> <span class="nv">alias</span>: <span class="nv">Heizung</span> <span class="nv">auf</span> <span class="nv">Standby</span> <span class="nv">Start</span>
    <span class="nv">trigger</span>:
      <span class="nv">platform</span>: <span class="nv">state</span>
      <span class="nv">entity_id</span>: <span class="nv">input_boolean</span>.<span class="nv">heizungstandbyon</span>
      <span class="nv">to</span>: <span class="s1">&#39;</span><span class="s">on</span><span class="s1">&#39;</span>
    <span class="nv">action</span>:
    <span class="o">-</span>  <span class="nv">service</span>: <span class="nv">timer</span>.<span class="nv">start</span>
       <span class="nv">entity_id</span>: <span class="nv">timer</span>.<span class="nv">heizungaufstandbyfor</span>
       <span class="nv">data_template</span>:
         <span class="nv">duration</span>: <span class="s2">&quot;</span><span class="s">{{ states(&#39;input_number.delayheizungstandby&#39;) | int * 60 * 60 }}</span><span class="s2">&quot;</span>
    <span class="o">-</span> <span class="nv">service</span>: <span class="nv">modbus</span>.<span class="nv">write_register</span>
      <span class="nv">data</span>:
        <span class="nv">address</span>: <span class="mi">2818</span>
        <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
        <span class="nv">unit</span>: <span class="mi">1</span>
        <span class="nv">value</span>: <span class="mi">5</span>    


  <span class="o">-</span> <span class="nv">alias</span>: <span class="nv">Heizung</span> <span class="nv">Standby</span> <span class="nv">To</span> <span class="nv">Automatic</span>
    <span class="nv">trigger</span>:
      <span class="nv">platform</span>: <span class="nv">state</span>
      <span class="nv">entity_id</span>: <span class="nv">input_boolean</span>.<span class="nv">heizungstandbyon</span>
      <span class="nv">to</span>: <span class="s1">&#39;</span><span class="s">off</span><span class="s1">&#39;</span>
    <span class="nv">action</span>:
    <span class="o">-</span> <span class="nv">service</span>: <span class="nv">timer</span>.<span class="nv">cancel</span>
      <span class="nv">entity_id</span>: <span class="nv">timer</span>.<span class="nv">heizungaufstandbyfor</span>
    <span class="o">-</span> <span class="nv">service</span>: <span class="nv">modbus</span>.<span class="nv">write_register</span>
      <span class="nv">data</span>:
        <span class="nv">address</span>: <span class="mi">2818</span>
        <span class="nv">hub</span>: <span class="nv">SolvisRemote</span>
        <span class="nv">unit</span>: <span class="mi">1</span>
        <span class="nv">value</span>: <span class="mi">2</span>


  <span class="o">-</span> <span class="nv">alias</span>: <span class="nv">Heizung</span> <span class="nv">Standby</span> <span class="nv">Timer</span> <span class="nv">Finished</span>
    <span class="nv">trigger</span>:
      <span class="nv">platform</span>: <span class="nv">event</span>
      <span class="nv">event_type</span>: <span class="nv">timer</span>.<span class="nv">finished</span>
      <span class="nv">event_data</span>:
        <span class="nv">entity_id</span>: <span class="nv">timer</span>.<span class="nv">heizungaufstandbyfor</span>
    <span class="nv">action</span>:
    <span class="o">-</span> <span class="nv">service</span>: <span class="nv">input_boolean</span>.<span class="nv">turn_off</span>
      <span class="nv">data</span>:
        <span class="nv">entity_id</span>: <span class="nv">input_boolean</span>.<span class="nv">heizungstandbyon</span>
</pre></div>
</td></tr></table>

<h2 id="links-zu-solvis-doku">Links zu Solvis Doku<a class="headerlink" href="#links-zu-solvis-doku" title="Permanent link">&para;</a></h2>
<p><a href="https://solvis-files.s3.eu-central-1.amazonaws.com/seiten/produkte/solvisremote/Download/SolvisRemote+Modbus+Spezifikationen+201906.pdf">Doku: Solvis Modbus Register</a></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright 2019-2020 - saruter. Creative Commons Attribution 4.0.</p>
    
  </div>

  <a href="https://github.com/saruter/smarthome/issues">Feedback</a> - Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a> 
</footer>

      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../.." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../feinstaubsensor/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
